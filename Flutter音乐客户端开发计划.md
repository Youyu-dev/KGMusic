# Flutter酷狗音乐桌面客户端开发计划

## 项目概述

基于KuGouMusicApi开发一个轻量级的Flutter桌面音乐客户端，提供完整的音乐播放体验。

## 技术栈

- **前端**: Flutter (桌面端)
- **后端API**: KuGouMusicApi (Node.js)
- **状态管理**: Provider/Riverpod
- **音频播放**: just_audio
- **网络请求**: dio
- **本地存储**: shared_preferences/hive

## 开发阶段规划

### 第一阶段：基础架构与登录模块 (1-2周)

#### 1.1 项目初始化
- [ ] 创建Flutter桌面项目
- [ ] 配置项目结构和依赖
- [ ] 设置状态管理架构
- [ ] 配置网络请求层

#### 1.2 API服务层
- [ ] 创建API基础服务类
- [ ] 实现HTTP客户端封装
- [ ] 添加请求拦截器和错误处理
- [ ] 实现Cookie管理

#### 1.3 用户认证模块
- [ ] 实现登录界面UI
- [ ] 集成用户名密码登录 (`/v9/login_by_pwd`)
- [ ] 集成手机验证码登录 (`/v7/login_by_verifycode`)
- [ ] 实现发送验证码功能 (`/v2/send_code`)
- [ ] 实现登录状态持久化
- [ ] 添加自动登录功能

### 第二阶段：音乐搜索与发现 (1-2周)

#### 2.1 搜索功能
- [ ] 实现搜索界面UI
- [ ] 集成音乐搜索 (`/v3/search/song`)
- [ ] 集成综合搜索 (`/v6/search/complex`)
- [ ] 实现搜索建议 (`/v2/getSearchTip`)
- [ ] 添加热搜列表 (`/api/v3/search/hot_tab`)
- [ ] 实现搜索历史记录

#### 2.2 音乐发现
- [ ] 实现首页推荐界面
- [ ] 集成新歌速递 (`/top/song`)
- [ ] 集成编辑精选 (`/v2/get_recommend_data`)
- [ ] 集成私人FM (`/v2/fm/get_list`)
- [ ] 实现Banner展示

### 第三阶段：播放列表与歌单管理 (2-3周)

#### 3.1 歌单功能
- [ ] 实现歌单列表界面
- [ ] 集成获取用户歌单 (`/v2/user/special`)
- [ ] 集成歌单详情 (`/v2/special/info`)
- [ ] 集成歌单歌曲列表 (`/v2/special/song`)
- [ ] 实现歌单创建/删除功能
- [ ] 实现歌单歌曲添加/删除

#### 3.2 收藏与历史
- [ ] 实现收藏歌曲管理
- [ ] 集成听歌历史 (`/v2/user/song_history`)
- [ ] 实现最近播放列表
- [ ] 集成继续播放功能

### 第四阶段：音乐播放核心功能 (2-3周)

#### 4.1 音频播放器
- [ ] 集成just_audio播放器
- [ ] 实现播放控制(播放/暂停/上一首/下一首)
- [ ] 实现进度控制和显示
- [ ] 实现音量控制
- [ ] 实现播放模式(顺序/随机/单曲循环)

#### 4.2 音乐URL获取
- [ ] 集成音乐URL获取 (`/v5/url`)
- [ ] 集成新版音乐URL (`/v6/priv_url`)
- [ ] 实现音质选择功能
- [ ] 添加播放失败重试机制

#### 4.3 播放界面
- [ ] 设计播放器主界面
- [ ] 实现专辑封面显示
- [ ] 实现歌词显示 (`/v1/lyric`)
- [ ] 实现播放队列管理
- [ ] 添加迷你播放器模式

### 第五阶段：高级功能 (2-3周)

#### 5.1 歌词与音效
- [ ] 实现滚动歌词显示
- [ ] 集成歌词搜索功能
- [ ] 实现音效设置(如果支持)
- [ ] 添加歌曲高潮部分预览

#### 5.2 用户体验优化
- [ ] 实现主题切换(深色/浅色模式)
- [ ] 添加快捷键支持
- [ ] 实现系统托盘功能
- [ ] 添加桌面歌词显示
- [ ] 实现媒体键控制

#### 5.3 数据管理
- [ ] 实现本地缓存机制
- [ ] 添加离线播放支持
- [ ] 实现播放统计
- [ ] 添加数据同步功能

### 第六阶段：完善与优化 (1-2周)

#### 6.1 性能优化
- [ ] 优化内存使用
- [ ] 实现图片缓存
- [ ] 优化网络请求
- [ ] 添加加载状态管理

#### 6.2 错误处理与测试
- [ ] 完善错误处理机制
- [ ] 添加网络异常处理
- [ ] 实现单元测试
- [ ] 进行集成测试

#### 6.3 打包与发布
- [ ] 配置应用图标和元数据
- [ ] 实现自动更新机制
- [ ] 生成安装包
- [ ] 编写用户文档

## 核心API接口映射

### 用户认证相关
- 登录: `/v9/login_by_pwd`
- 手机登录: `/v7/login_by_verifycode`
- 发送验证码: `/v2/send_code`
- 刷新登录: `/v5/login_by_token`

### 音乐搜索相关
- 音乐搜索: `/v3/search/song`
- 综合搜索: `/v6/search/complex`
- 搜索建议: `/v2/getSearchTip`
- 热搜列表: `/api/v3/search/hot_tab`

### 播放相关
- 获取音乐URL: `/v5/url`
- 获取音乐URL(新版): `/v6/priv_url`
- 获取歌词: `/v1/lyric`
- 音乐详情: `/privilege/lite`

### 歌单相关
- 用户歌单: `/v2/user/special`
- 歌单详情: `/v2/special/info`
- 歌单歌曲: `/v2/special/song`
- 听歌历史: `/v2/user/song_history`

## 项目结构建议

```
flutter_kugou_music/
├── lib/
│   ├── main.dart
│   ├── app/
│   │   ├── app.dart
│   │   └── routes.dart
│   ├── core/
│   │   ├── api/
│   │   ├── constants/
│   │   ├── utils/
│   │   └── services/
│   ├── features/
│   │   ├── auth/
│   │   ├── search/
│   │   ├── playlist/
│   │   ├── player/
│   │   └── home/
│   ├── shared/
│   │   ├── widgets/
│   │   ├── models/
│   │   └── providers/
│   └── assets/
├── test/
└── pubspec.yaml
```

## 开发优先级

1. **高优先级**: 登录、搜索、基础播放
2. **中优先级**: 歌单管理、歌词显示
3. **低优先级**: 高级音效、桌面歌词、系统集成

## 技术要点

1. **API集成**: 需要处理KuGou API的加密和签名机制
2. **音频播放**: 使用just_audio处理多种音频格式
3. **状态管理**: 合理管理播放状态、用户状态等
4. **缓存策略**: 实现音乐、图片、数据的本地缓存
5. **错误处理**: 网络异常、播放失败等场景处理

## 里程碑

- **里程碑1**: 完成登录和基础架构
- **里程碑2**: 完成搜索和音乐播放
- **里程碑3**: 完成歌单管理
- **里程碑4**: 完成所有核心功能
- **里程碑5**: 完成优化和发布

## 注意事项

1. 遵守音乐版权相关法律法规
2. 合理使用API，避免频繁请求
3. 注意用户隐私保护
4. 确保跨平台兼容性
5. 保持代码质量和可维护性

---

*本计划表将根据开发进度和实际需求进行调整*
